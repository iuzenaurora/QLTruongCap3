@model IEnumerable<QLTruongCap3.Models.THOIKHOABIEU>
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<h2 class="text-center text-primary fw-bold mb-4">📅 Quản Lý Thời Khóa Biểu</h2>

@if (TempData["Message"] != null)
{
    <div id="alertMessage" class="alert alert-success text-center fw-bold shadow-sm">@TempData["Message"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger text-center fw-bold shadow-sm">@TempData["Error"]</div>
}

<script>
    setTimeout(function () {
        var msg = document.getElementById("alertMessage");
        var err = document.getElementById("alertError");
        if (msg) msg.style.display = "none";
        if (err) err.style.display = "none";
    }, 5000);
</script>

<!-- Nút thêm -->
<div class="d-flex justify-content-end mb-3">
    <a href="@Url.Action("ThemTKB", "Admin")" class="btn btn-success shadow-sm fw-bold">
        <i class="bi bi-calendar-plus"></i> Xếp TKB Mới
    </a>
</div>

<!-- Form tìm kiếm: Đơn giản, Ngay ngắn (Không dùng Card) -->
@using (Html.BeginForm("QuanLyTKB", "Admin", FormMethod.Get, new { @class = "row g-3 mb-4 align-items-end justify-content-center" }))
{
    <div class="col-md-2">
        <label class="form-label fw-bold small text-secondary ps-1">Năm Học</label>
        @Html.DropDownList("searchNamHoc", (IEnumerable<SelectListItem>)ViewBag.NamList, new { @class = "form-select shadow-sm" })
    </div>
    <div class="col-md-2">
        <label class="form-label fw-bold small text-secondary ps-1">Học Kỳ</label>
        @Html.DropDownList("searchHocKy", (IEnumerable<SelectListItem>)ViewBag.HKList, new { @class = "form-select shadow-sm" })
    </div>
    <div class="col-md-3">
        <label class="form-label fw-bold small text-secondary ps-1">Lớp</label>
        @Html.DropDownList("searchMaLop", (IEnumerable<SelectListItem>)ViewBag.LopList, "--- Tất cả lớp ---", new { @class = "form-select shadow-sm" })
    </div>
    <div class="col-md-3">
        <label class="form-label fw-bold small text-secondary ps-1">Giáo Viên</label>
        @Html.DropDownList("searchMaGV", (IEnumerable<SelectListItem>)ViewBag.GVList, "--- Tất cả GV ---", new { @class = "form-select shadow-sm" })
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100 shadow-sm fw-bold">
            <i class="bi bi-filter"></i> Lọc dữ liệu
        </button>
    </div>
}

<!-- Bảng dữ liệu -->
<div class="table-responsive bg-white rounded shadow-sm">
    <table class="table table-hover table-striped align-middle mb-0">
        <thead class="table-primary text-center">
            <tr>
                <th class="py-3">Thứ</th>
                <th class="py-3">Tiết</th>
                <th class="py-3">Lớp</th>
                <th class="py-3">Môn Học</th>
                <th class="py-3">Giáo Viên</th>
                <th class="py-3">Phòng</th>
                <th class="py-3">Thao Tác</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Any())
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td class="text-center fw-bold">Thứ @item.THU</td>
                        <td class="text-center"><span class="badge bg-secondary rounded-pill">Tiết @item.TIET</span></td>
                        <td class="text-center fw-bold text-primary">@item.LOP.TENLOP</td>
                        <td class="fw-bold">@item.MONHOC.TENMH</td>
                        <td>@item.GIAOVIEN.HOTEN</td>
                        <td class="text-center">@item.PHONGHOC.TENPHONG</td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <a href="@Url.Action("SuaTKB", "Admin", new { maLop = item.MALOP, maNam = item.MANAM, maHK = item.MAHK, thu = item.THU, tiet = item.TIET })"
                                   class="btn btn-sm btn-outline-warning" title="Sửa">
                                    <i class="bi bi-pencil-square"></i>
                                </a>

                                <a href="@Url.Action("XoaTKB", "Admin", new { maLop = item.MALOP, maNam = item.MANAM, maHK = item.MAHK, thu = item.THU, tiet = item.TIET })"
                                   class="btn btn-sm btn-outline-danger" title="Xóa">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="7" class="text-center py-5 text-muted">Chưa có dữ liệu thời khóa biểu phù hợp.</td></tr>
            }
        </tbody>
    </table>
</div>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">