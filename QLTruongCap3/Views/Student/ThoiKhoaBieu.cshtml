@using QLTruongCap3.Models
<!-- Khai báo Model là List kết quả trả về từ Procedure -->
@model IEnumerable<sp_HS_XemThoiKhoaBieu_Result>

@{
    Layout = "~/Views/Shared/_LayoutStudent.cshtml";
    ViewBag.Title = "Thời Khóa Biểu";
}

<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-success border-bottom pb-2">
            <i class="fas fa-calendar-alt me-2"></i>THỜI KHÓA BIỂU CỦA TÔI
        </h2>
    </div>
</div>

<!-- 1. Form Chọn Năm/Học Kỳ -->
@using (Html.BeginForm("ThoiKhoaBieu", "Student", FormMethod.Get, new { @class = "card p-3 mb-4 bg-white border-0 shadow-sm" }))
{
    <div class="row g-3 align-items-end">
        <div class="col-md-5">
            <label class="form-label fw-bold text-secondary">Năm học</label>
            @Html.DropDownList("maNam", (SelectList)ViewBag.MaNam, new { @class = "form-select", onchange = "this.form.submit()" })
        </div>
        <div class="col-md-5">
            <label class="form-label fw-bold text-secondary">Học kỳ</label>
            <select name="maHK" class="form-select" onchange="this.form.submit()">
                <option value="HK1" @(ViewBag.SelectedHK == "HK1" ? "selected" : "")>Học kỳ 1</option>
                <option value="HK2" @(ViewBag.SelectedHK == "HK2" ? "selected" : "")>Học kỳ 2</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">
                <i class="fas fa-search"></i> Xem
            </button>
        </div>
    </div>
}

<!-- 2. Hiển thị Lưới Thời Khóa Biểu -->
@if (Model != null && Model.Any())
{
    <div class="card shadow-sm border-0">
        <div class="card-body p-0 table-responsive">
            <table class="table table-bordered text-center align-middle mb-0">
                <thead class="bg-success text-white">
                    <tr>
                        <th style="width: 10%">Tiết</th>
                        <th style="width: 15%">Thứ 2</th>
                        <th style="width: 15%">Thứ 3</th>
                        <th style="width: 15%">Thứ 4</th>
                        <th style="width: 15%">Thứ 5</th>
                        <th style="width: 15%">Thứ 6</th>
                        <th style="width: 15%">Thứ 7</th>
                    </tr>
                </thead>
                <tbody>
                    @* Vòng lặp hiển thị 10 tiết học *@
                    @for (int tiet = 1; tiet <= 10; tiet++)
                    {
                        <tr>
                            <td class="fw-bold bg-light">Tiết @tiet</td>
                            @* Vòng lặp hiển thị các ngày trong tuần (2 đến 7) *@
                            @for (int thu = 2; thu <= 7; thu++)
                            {
                                // Tìm môn học tại Thứ và Tiết tương ứng trong Model
                                var monHoc = Model.FirstOrDefault(m => m.THU == thu && m.TIET == tiet);

                                if (monHoc != null)
                                {
                                    <td class="bg-white">
                                        <div class="fw-bold text-primary">@monHoc.TENMH</div>
                                        <div class="small text-muted"><i class="fas fa-user me-1"></i>@monHoc.TENGV</div>
                                        <div class="small text-success badge bg-light text-dark border mt-1">
                                            @monHoc.TENPHONG
                                        </div>
                                    </td>
                                }
                                else
                                {
                                    <td class="bg-light"></td>
 <!-- Ô trống -->
                                }
                            }
                        </tr>
                        if (tiet == 5) // Ngắt quãng nghỉ trưa
                        {
                            <tr class="table-secondary"><td colspan="7" class="py-1 text-center small fw-bold text-uppercase">Nghỉ trưa</td></tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning shadow-sm mt-3 text-center">
        <i class="fas fa-calendar-times fa-2x mb-2 d-block"></i>
        Chưa có thời khóa biểu cho học kỳ này.
    </div>
}